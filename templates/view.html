<html>
    <head>
        <title>View</title>

        <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flag-icon-css@3.5.0/css/flag-icon.min.css">

        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="stylesheet" href="css/general.css">
        <script src="js/general.js"></script>
    </head>
    <body>
        <nav class="light-blue">
            <div class="nav-wrapper container">
                <a href="/" id="brand-logo" class="white-text brand-logo">4x4sport.info</a>
                <ul class="right hide-on-med-and-down">
                    <li><a href="events">Events</a></li>
                </ul>
            </div>
        </nav>
        <div class="container">
            <div class="hide-on-med-and-up">
                Minimap
            </div>
            <div class="section">
                <h5>Information</h5>
                <div class="divider"></div>

                <div class="row">
                    <div class="col s12 m8">
                        <table>
                            <tr>
                                <td>Name</td>
                                <td><span id="name-field"></span></td>
                            </tr>
                            <tr>
                                <td>Description</td>
                                <td><a id="description-button" href="#description" class="hide btn modal-trigger">View ></a></td>
                            </tr>
                            <tr>
                                <td>Start</td>
                                <td><span id="start-field"></span> <span class="new badge red" data-badge-caption="" id="days-left-field"></span></td>
                            </tr>
                            <tr>
                                <td>Duration</td>
                                <td><span id="duration-field"></span></td>
                            </tr>
                            <tr>
                                <td>Country</td>
                                <td><span id="country-field"></span></td>
                            </tr>
                            <tr>
                                <td>Classes</td>
                                <td><span id="classes-field"></span></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col m4 hide-on-small-only">
                        Maximap
                    </div>
                </div>
            </div>
            <div class="section">
                <h5>Logo</h5>
                <div class="divider"></div><br>
                <div id="logo-field"></div>
            </div>
            <div class="section">
                <h5>Media</h5>
                <div class="divider"></div><br>
                <a id="media-button" href="#media" class="hide btn modal-trigger">View ></a>
            </div>
            <div class="section">
                <h5>Links</h5>
                <div class="divider"></div>
                <div id="links-field"></div>
            </div>
        </div>

        <div id="media" class="modal"></div>
        <div id="description" class="modal">
            <div class="container">
                <span class="flow-text" id="description-field"></span>
            </div>
        </div>
    </body>
    <script>
        M.AutoInit();

        let query = new URLSearchParams(document.location.search);

        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if(this.readyState == 4 && this.status == 200) {
                let data = JSON.parse(this.responseText);

                let event = data[0];

                $("#name-field").text(event.name);

                if(event.description) {
                    $("#description-button").removeClass("hide");
                    $("#description-field").text(event.description);
                }

                $("#start-field").text(event.start);
                $("#days-left-field").text(`
                    ${
                        parseInt(
                            Math.ceil(
                                Math.abs(new Date() - makeDate(event.start)) / 86400000
                            )
                        )
                    } days left!
                `);

                $("#duration-field").text(event.duration);

                $("#country-field").text(event.country.toUpperCase());

                if(event.classes) $("#classes-field").html(event.classes.map(i => `<div class="chip">${i}</div>`).join(""));

                if(event.logo) $("#logo-field").html(`
                    <img class="logo" src="images/${event.logo}"></img>
                `);

                if(event.media) {
                    $("#media-button").removeClass("hide");
                    $("#media").html(event.media.map(i => `
                        <img class="media" src="images/${i}"></img>
                    `));
                }

                if(event.links) $("#links-field").html(`
                    <ul>
                        ${Object.keys(event.links).map(i => `
                            <li>
                                <a href="${event.links[i]}">
                                    <h6>${i}</h6>
                                </a>
                            </li>
                        `).join("")}
                    </ul>
                `);
            }
        };

        xhr.open("GET", "/query?id=" + query.get("id"), true);
        xhr.send();
    </script>
</html>